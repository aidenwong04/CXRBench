# Adapted from SubpopBench (https://github.com/YyzHarry/SubpopBench).
# Linear probing config for CXR-CLIP ResNet50-M on MIMIC-CXR (multi-label).

model:
  checkpoint_path: /restricted/projectnb/batmanlab/ahcmwong/checkpoints/ResNet50-M/resnet50m_state.pt
  encoder: resnet50
  freeze_encoder: true
  image_size: 224
  mean: [0.485, 0.456, 0.406] # update to CXR-CLIP stats if they differ
  std: [0.229, 0.224, 0.225]
  classifier_dropout: 0.0

data:
  # Per-split metadata CSVs (no need to merge). Reuse val as test here.
  metadata_csv:
    train: /restricted/projectnb/batmanlab/shared/Data/chestXRayDatasets/MIMICCXR/train.csv
    val: /restricted/projectnb/batmanlab/shared/Data/chestXRayDatasets/MIMICCXR/valid.csv
    test: /restricted/projectnb/batmanlab/shared/Data/chestXRayDatasets/MIMICCXR/valid.csv

  # Base dir that prefixes the relative paths in the CSV (paths already include 'train/...').
  image_root: /restricted/projectnb/batmanlab/shared/Data/chestXRayDatasets/MIMICCXR
  path_column: path # column with relative paths
  label_columns:
    [
      "No Finding",
      "Enlarged Cardiomediastinum",
      "Cardiomegaly",
      "Airspace Opacity",
      "Lung Lesion",
      "Edema",
      "Consolidation",
      "Pneumonia",
      "Atelectasis",
      "Pneumothorax",
      "Pleural Effusion",
      "Pleural Other",
      "Fracture",
      "Support Devices",
    ]
  split_column: null # not needed with per-split CSVs
  uncertain_policy: zero # map -1 -> 0
  num_workers: 8

training:
  batch_size: 32
  num_epochs: 10
  lr: 1e-3
  weight_decay: 1e-4
  optimizer: adam
  use_fp16: true

logging:
  output_dir: /restricted/projectnb/batmanlab/ahcmwong/outputs/classification/linear_probe/cxr_clip/ResNet50-M/
  log_every: 50
  eval_every: 1 # evaluate every N epochs
  save_ckpt: true
